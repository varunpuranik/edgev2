<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="513px" preserveAspectRatio="none" style="width:957px;height:513px;" version="1.1" viewBox="0 0 957 513" width="957px" zoomAndPan="magnify"><defs><filter height="300%" id="f1h9kpq7bzwejm" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="312" x="323" y="26.6992">Provisioning using X.509 device ID cert</text><rect fill="#DDDDDD" height="463.8594" style="stroke: #A80036; stroke-width: 1.0;" width="276.5" x="303" y="39.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="432.25" y="51.1543">KS</text><rect fill="#DDDDDD" height="463.8594" style="stroke: #A80036; stroke-width: 1.0;" width="317.5" x="581.5" y="39.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="731.25" y="51.1543">CS</text><rect fill="#FFFFFF" filter="url(#f1h9kpq7bzwejm)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="223" y="241.9063"/><rect fill="#FFFFFF" filter="url(#f1h9kpq7bzwejm)" height="87.7031" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="319.5" y="124.9688"/><rect fill="#FFFFFF" filter="url(#f1h9kpq7bzwejm)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="505.5" y="154.2031"/><rect fill="#FFFFFF" filter="url(#f1h9kpq7bzwejm)" height="87.7031" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="598.5" y="300.375"/><rect fill="#FFFFFF" filter="url(#f1h9kpq7bzwejm)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="822.5" y="329.6094"/><rect fill="#FFFFFF" filter="url(#f1h9kpq7bzwejm)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="922.5" y="417.3125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="23" x2="23" y1="93.7344" y2="464.5469"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="228" x2="228" y1="93.7344" y2="464.5469"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="324" x2="324" y1="93.7344" y2="464.5469"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="510.5" x2="510.5" y1="93.7344" y2="464.5469"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="603.5" x2="603.5" y1="93.7344" y2="464.5469"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="827" x2="827" y1="93.7344" y2="464.5469"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="927" x2="927" y1="93.7344" y2="464.5469"/><rect fill="#FEFECE" filter="url(#f1h9kpq7bzwejm)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="26" x="8" y="58.3281"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="12" x="15" y="78.3164">IS</text><rect fill="#FEFECE" filter="url(#f1h9kpq7bzwejm)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="26" x="8" y="463.5469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="12" x="15" y="483.5352">IS</text><rect fill="#FEFECE" filter="url(#f1h9kpq7bzwejm)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="134" x="159" y="58.3281"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="120" x="166" y="78.3164">openssl-engine-ks</text><rect fill="#FEFECE" filter="url(#f1h9kpq7bzwejm)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="134" x="159" y="463.5469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="120" x="166" y="483.5352">openssl-engine-ks</text><rect fill="#FEFECE" filter="url(#f1h9kpq7bzwejm)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="31" x="307" y="58.3281"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="17" x="314" y="78.3164">KS</text><rect fill="#FEFECE" filter="url(#f1h9kpq7bzwejm)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="31" x="307" y="463.5469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="17" x="314" y="483.5352">KS</text><rect fill="#FEFECE" filter="url(#f1h9kpq7bzwejm)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="126" x="445.5" y="58.3281"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="112" x="452.5" y="78.3164">libiothsm-keygen</text><rect fill="#FEFECE" filter="url(#f1h9kpq7bzwejm)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="126" x="445.5" y="463.5469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="112" x="452.5" y="483.5352">libiothsm-keygen</text><rect fill="#FEFECE" filter="url(#f1h9kpq7bzwejm)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="32" x="585.5" y="58.3281"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="18" x="592.5" y="78.3164">CS</text><rect fill="#FEFECE" filter="url(#f1h9kpq7bzwejm)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="32" x="585.5" y="463.5469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="18" x="592.5" y="483.5352">CS</text><rect fill="#FEFECE" filter="url(#f1h9kpq7bzwejm)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="131" x="760" y="58.3281"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="117" x="767" y="78.3164">libiothsm-certgen</text><rect fill="#FEFECE" filter="url(#f1h9kpq7bzwejm)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="131" x="760" y="463.5469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="117" x="767" y="483.5352">libiothsm-certgen</text><rect fill="#FEFECE" filter="url(#f1h9kpq7bzwejm)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="41" x="905" y="58.3281"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27" x="912" y="78.3164">DPS</text><rect fill="#FEFECE" filter="url(#f1h9kpq7bzwejm)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="41" x="905" y="463.5469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27" x="912" y="483.5352">DPS</text><rect fill="#FFFFFF" filter="url(#f1h9kpq7bzwejm)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="223" y="241.9063"/><rect fill="#FFFFFF" filter="url(#f1h9kpq7bzwejm)" height="87.7031" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="319.5" y="124.9688"/><rect fill="#FFFFFF" filter="url(#f1h9kpq7bzwejm)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="505.5" y="154.2031"/><rect fill="#FFFFFF" filter="url(#f1h9kpq7bzwejm)" height="87.7031" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="598.5" y="300.375"/><rect fill="#FFFFFF" filter="url(#f1h9kpq7bzwejm)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="822.5" y="329.6094"/><rect fill="#FFFFFF" filter="url(#f1h9kpq7bzwejm)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="922.5" y="417.3125"/><polygon fill="#A80036" points="307.5,120.9688,317.5,124.9688,307.5,128.9688,311.5,124.9688" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="23" x2="313.5" y1="124.9688" y2="124.9688"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="157" x="30" y="119.7949">load_key_pair("device_id")</text><polygon fill="#A80036" points="493.5,150.2031,503.5,154.2031,493.5,158.2031,497.5,154.2031" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="329.5" x2="499.5" y1="154.2031" y2="154.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="157" x="336.5" y="149.0293">load_key_pair("device_id")</text><polygon fill="#A80036" points="340.5,179.4375,330.5,183.4375,340.5,187.4375,336.5,183.4375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="334.5" x2="509.5" y1="183.4375" y2="183.4375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="17" x="346.5" y="178.2637">OK</text><polygon fill="#A80036" points="34,208.6719,24,212.6719,34,216.6719,30,212.6719" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="28" x2="323.5" y1="212.6719" y2="212.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="40" y="207.498">OK("key handle")</text><polygon fill="#A80036" points="211,237.9063,221,241.9063,211,245.9063,215,241.9063" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="23" x2="217" y1="241.9063" y2="241.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="30" y="236.7324">load_private_key("key handle")</text><polygon fill="#A80036" points="34,267.1406,24,271.1406,34,275.1406,30,271.1406" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="28" x2="227" y1="271.1406" y2="271.1406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="115" x="40" y="265.9668">openssl::EVP_PKEY</text><polygon fill="#A80036" points="586.5,296.375,596.5,300.375,586.5,304.375,590.5,300.375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="23" x2="592.5" y1="300.375" y2="300.375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="195" x="30" y="295.2012">create_or_load_cert("device_id")</text><polygon fill="#A80036" points="810.5,325.6094,820.5,329.6094,810.5,333.6094,814.5,329.6094" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="608.5" x2="816.5" y1="329.6094" y2="329.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="195" x="615.5" y="324.4355">create_or_load_cert("device_id")</text><polygon fill="#A80036" points="619.5,354.8438,609.5,358.8438,619.5,362.8438,615.5,358.8438" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="613.5" x2="826.5" y1="358.8438" y2="358.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="625.5" y="353.6699">OK(openssl::X509)</text><polygon fill="#A80036" points="34,384.0781,24,388.0781,34,392.0781,30,388.0781" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="28" x2="602.5" y1="388.0781" y2="388.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="40" y="382.9043">OK(cert PEM)</text><polygon fill="#A80036" points="910.5,413.3125,920.5,417.3125,910.5,421.3125,914.5,417.3125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="23" x2="916.5" y1="417.3125" y2="417.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="489" x="30" y="412.1387">TLS client auth using privkeys's openssl::EVP_PKEY + openssl::X509 from cert PEM</text><polygon fill="#A80036" points="34,442.5469,24,446.5469,34,450.5469,30,446.5469" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="28" x2="926.5" y1="446.5469" y2="446.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133" x="40" y="441.373">Provisioning response</text><!--MD5=[ee434bbf34387c43b533cb1357794040]
@startuml

title Provisioning using X.509 device ID cert

participant IS
participant "openssl-engine-ks"

box KS
participant KS
participant "libiothsm-keygen"
end box

box CS
participant CS
participant "libiothsm-certgen"
end box

participant DPS

IS -> KS ++: load_key_pair("device_id")
KS -> "libiothsm-keygen" ++: load_key_pair("device_id")
return OK
return OK("key handle")
IS -> "openssl-engine-ks" ++: load_private_key("key handle")
return openssl::EVP_PKEY

IS -> CS ++: create_or_load_cert("device_id")
CS -> "libiothsm-certgen" ++: create_or_load_cert("device_id")
return OK(openssl::X509)
return OK(cert PEM)

IS -> DPS ++: TLS client auth using privkeys's openssl::EVP_PKEY + openssl::X509 from cert PEM
return Provisioning response

@enduml

PlantUML version 1.2020.06(Sun Apr 05 05:38:32 PDT 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.6+10-suse-3.1-x8664
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>