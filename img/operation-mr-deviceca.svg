<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2461px" preserveAspectRatio="none" style="width:1148px;height:2461px;" version="1.1" viewBox="0 0 1148 2461" width="1148px" zoomAndPan="magnify"><defs><filter height="300%" id="f1m3me46sidl98" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="230.6406" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="47.5" y="1237.6094"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="230.6406" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="47.5" y="1528.7188"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="246.875" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="47.5" y="1819.8281"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="270.5" y="1036.0313"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="172.1719" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="270.5" y="1266.8438"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="172.1719" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="270.5" y="1557.9531"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="188.4063" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="270.5" y="1849.0625"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="270.5" y="2158.4063"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="172.1719" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="270.5" y="2216.875"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="704.5" y="242.0469"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="704.5" y="448.6875"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="87.7031" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="704.5" y="589.8594"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="87.7031" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="704.5" y="822.3906"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="87.7031" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="704.5" y="1920.5313"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="855.5" y="93.875"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="855.5" y="183.5781"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="855.5" y="390.2188"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="855.5" y="619.0938"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="855.5" y="851.625"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="855.5" y="1338.3125"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="855.5" y="1629.4219"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="855.5" y="1949.7656"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="855.5" y="2288.3438"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="901" y="300.5156"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="901" y="507.1563"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="901" y="706.7969"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="901" y="939.3281"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="75.7031" style="stroke: #000000; stroke-width: 2.0;" width="865" x="23" y="55.4063"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="192.6406" style="stroke: #000000; stroke-width: 2.0;" width="911" x="23" y="145.1094"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="631.8125" style="stroke: #000000; stroke-width: 2.0;" width="931" x="13" y="351.75"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="425.1719" style="stroke: #000000; stroke-width: 2.0;" width="911" x="23" y="551.3906"/><rect fill="#FFFFFF" height="232.5313" style="stroke: none; stroke-width: 1.0;" width="911" x="23" y="744.0313"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="163.3438" style="stroke: #000000; stroke-width: 2.0;" width="987" x="23" y="997.5625"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="906.7969" style="stroke: #000000; stroke-width: 2.0;" width="1007" x="13" y="1174.9063"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="277.1094" style="stroke: #000000; stroke-width: 2.0;" width="987" x="23" y="1199.1406"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="277.1094" style="stroke: #000000; stroke-width: 2.0;" width="987" x="23" y="1490.25"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="293.3438" style="stroke: #000000; stroke-width: 2.0;" width="987" x="23" y="1781.3594"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="308.3438" style="stroke: #000000; stroke-width: 2.0;" width="896.5" x="240.5" y="2095.7031"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="277.1094" style="stroke: #000000; stroke-width: 2.0;" width="876.5" x="250.5" y="2119.9375"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="52" x2="52" y1="38.4063" y2="2421.0469"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="275.5" x2="275.5" y1="38.4063" y2="2421.0469"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="709.5" x2="709.5" y1="38.4063" y2="2421.0469"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="860" x2="860" y1="38.4063" y2="2421.0469"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="906" x2="906" y1="38.4063" y2="2421.0469"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="967" x2="967" y1="1148.2031" y2="2421.0469"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1063" x2="1063" y1="38.4063" y2="2421.0469"/><rect fill="#FEFECE" filter="url(#f1m3me46sidl98)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="35" x="33" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="21" x="40" y="22.9883">MR</text><rect fill="#FEFECE" filter="url(#f1m3me46sidl98)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="35" x="33" y="2420.0469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="21" x="40" y="2440.0352">MR</text><rect fill="#FEFECE" filter="url(#f1m3me46sidl98)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="26" x="260.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="12" x="267.5" y="22.9883">IS</text><rect fill="#FEFECE" filter="url(#f1m3me46sidl98)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="26" x="260.5" y="2420.0469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="12" x="267.5" y="2440.0352">IS</text><rect fill="#FEFECE" filter="url(#f1m3me46sidl98)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="134" x="640.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="120" x="647.5" y="22.9883">openssl-engine-ks</text><rect fill="#FEFECE" filter="url(#f1m3me46sidl98)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="134" x="640.5" y="2420.0469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="120" x="647.5" y="2440.0352">openssl-engine-ks</text><rect fill="#FEFECE" filter="url(#f1m3me46sidl98)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="31" x="843" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="17" x="850" y="22.9883">KS</text><rect fill="#FEFECE" filter="url(#f1m3me46sidl98)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="31" x="843" y="2420.0469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="17" x="850" y="2440.0352">KS</text><rect fill="#FEFECE" filter="url(#f1m3me46sidl98)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="32" x="888" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="18" x="895" y="22.9883">CS</text><rect fill="#FEFECE" filter="url(#f1m3me46sidl98)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="32" x="888" y="2420.0469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="18" x="895" y="2440.0352">CS</text><rect fill="#FEFECE" filter="url(#f1m3me46sidl98)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="62" x="934" y="2420.0469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="48" x="941" y="2440.0352">Module</text><rect fill="#FEFECE" filter="url(#f1m3me46sidl98)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="103" x="1010" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="89" x="1017" y="22.9883">Host_Module</text><rect fill="#FEFECE" filter="url(#f1m3me46sidl98)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="103" x="1010" y="2420.0469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="89" x="1017" y="2440.0352">Host_Module</text><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="230.6406" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="47.5" y="1237.6094"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="230.6406" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="47.5" y="1528.7188"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="246.875" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="47.5" y="1819.8281"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="270.5" y="1036.0313"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="172.1719" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="270.5" y="1266.8438"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="172.1719" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="270.5" y="1557.9531"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="188.4063" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="270.5" y="1849.0625"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="270.5" y="2158.4063"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="172.1719" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="270.5" y="2216.875"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="704.5" y="242.0469"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="704.5" y="448.6875"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="87.7031" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="704.5" y="589.8594"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="87.7031" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="704.5" y="822.3906"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="87.7031" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="704.5" y="1920.5313"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="855.5" y="93.875"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="855.5" y="183.5781"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="855.5" y="390.2188"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="855.5" y="619.0938"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="855.5" y="851.625"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="855.5" y="1338.3125"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="855.5" y="1629.4219"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="855.5" y="1949.7656"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="855.5" y="2288.3438"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="901" y="300.5156"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="901" y="507.1563"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="901" y="706.7969"/><rect fill="#FFFFFF" filter="url(#f1m3me46sidl98)" height="29.2344" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="901" y="939.3281"/><path d="M23,55.4063 L216,55.4063 L216,62.4063 L206,72.4063 L23,72.4063 L23,55.4063 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="75.7031" style="stroke: #000000; stroke-width: 2.0;" width="865" x="23" y="55.4063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="148" x="38" y="68.4668">Master encryption key</text><polygon fill="#A80036" points="843.5,89.875,853.5,93.875,843.5,97.875,847.5,93.875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52.5" x2="849.5" y1="93.875" y2="93.875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="205" x="59.5" y="88.7012">create_key_if_not_exists("master")</text><polygon fill="#A80036" points="63.5,119.1094,53.5,123.1094,63.5,127.1094,59.5,123.1094" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="57.5" x2="859.5" y1="123.1094" y2="123.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="69.5" y="117.9355">OK("key handle")</text><path d="M23,145.1094 L133,145.1094 L133,152.1094 L123,162.1094 L23,162.1094 L23,145.1094 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="192.6406" style="stroke: #000000; stroke-width: 2.0;" width="911" x="23" y="145.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="65" x="38" y="158.1699">Device CA</text><polygon fill="#A80036" points="843.5,179.5781,853.5,183.5781,843.5,187.5781,847.5,183.5781" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52.5" x2="849.5" y1="183.5781" y2="183.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="59.5" y="178.4043">load_key_pair("device_ca")</text><polygon fill="#A80036" points="63.5,208.8125,53.5,212.8125,63.5,216.8125,59.5,212.8125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="57.5" x2="859.5" y1="212.8125" y2="212.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="69.5" y="207.6387">OK("key handle")</text><polygon fill="#A80036" points="692.5,238.0469,702.5,242.0469,692.5,246.0469,696.5,242.0469" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52.5" x2="698.5" y1="242.0469" y2="242.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="59.5" y="236.873">load_private_key("key handle")</text><polygon fill="#A80036" points="63.5,267.2813,53.5,271.2813,63.5,275.2813,59.5,271.2813" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="57.5" x2="708.5" y1="271.2813" y2="271.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="115" x="69.5" y="266.1074">openssl::EVP_PKEY</text><polygon fill="#A80036" points="889,296.5156,899,300.5156,889,304.5156,893,300.5156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52.5" x2="895" y1="300.5156" y2="300.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="199" x="59.5" y="295.3418">create_or_load_cert("device_ca")</text><polygon fill="#A80036" points="63.5,325.75,53.5,329.75,63.5,333.75,59.5,329.75" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="57.5" x2="905" y1="329.75" y2="329.75"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="69.5" y="324.5762">OK(cert PEM)</text><path d="M13,351.75 L141,351.75 L141,358.75 L131,368.75 L13,368.75 L13,351.75 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="631.8125" style="stroke: #000000; stroke-width: 2.0;" width="931" x="13" y="351.75"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="83" x="28" y="364.8105">Workload CA</text><polygon fill="#A80036" points="843.5,386.2188,853.5,390.2188,843.5,394.2188,847.5,390.2188" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52.5" x2="849.5" y1="390.2188" y2="390.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="268" x="59.5" y="385.0449">create_key_pair_if_not_exists("workload_ca")</text><polygon fill="#A80036" points="63.5,415.4531,53.5,419.4531,63.5,423.4531,59.5,419.4531" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="57.5" x2="859.5" y1="419.4531" y2="419.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="69.5" y="414.2793">OK("key handle")</text><polygon fill="#A80036" points="692.5,444.6875,702.5,448.6875,692.5,452.6875,696.5,448.6875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52.5" x2="698.5" y1="448.6875" y2="448.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="59.5" y="443.5137">load_private_key("key handle")</text><polygon fill="#A80036" points="63.5,473.9219,53.5,477.9219,63.5,481.9219,59.5,477.9219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="57.5" x2="708.5" y1="477.9219" y2="477.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="115" x="69.5" y="472.748">openssl::EVP_PKEY</text><polygon fill="#A80036" points="889,503.1563,899,507.1563,889,511.1563,893,507.1563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52.5" x2="895" y1="507.1563" y2="507.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="213" x="59.5" y="501.9824">create_or_load_cert("workload_ca")</text><polygon fill="#A80036" points="63.5,532.3906,53.5,536.3906,63.5,540.3906,59.5,536.3906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="57.5" x2="905" y1="536.3906" y2="536.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="196" x="69.5" y="531.2168">OK(cert PEM) or Err(NOT_FOUND)</text><path d="M23,551.3906 L86,551.3906 L86,558.3906 L76,568.3906 L23,568.3906 L23,551.3906 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="425.1719" style="stroke: #000000; stroke-width: 2.0;" width="911" x="23" y="551.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="38" y="564.4512">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="100" x="101" y="563.5957">[if OK(cert PEM)]</text><polygon fill="#A80036" points="692.5,585.8594,702.5,589.8594,692.5,593.8594,696.5,589.8594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52.5" x2="698.5" y1="589.8594" y2="589.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="385" x="59.5" y="584.6855">openssl::X509_verify(CSR, device_ca privkey openssl::EVP_PKEY)</text><polygon fill="#A80036" points="843.5,615.0938,853.5,619.0938,843.5,623.0938,847.5,619.0938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="714.5" x2="849.5" y1="619.0938" y2="619.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="721.5" y="613.9199">sign("key handle", ...)</text><polygon fill="#A80036" points="725.5,644.3281,715.5,648.3281,725.5,652.3281,721.5,648.3281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="719.5" x2="859.5" y1="648.3281" y2="648.3281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="731.5" y="643.1543">OK(signature)</text><polygon fill="#A80036" points="63.5,673.5625,53.5,677.5625,63.5,681.5625,59.5,677.5625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="57.5" x2="708.5" y1="677.5625" y2="677.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="69.5" y="672.3887">OK(signed X509)</text><polygon fill="#A80036" points="889,702.7969,899,706.7969,889,710.7969,893,706.7969" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52.5" x2="895" y1="706.7969" y2="706.7969"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="59.5" y="701.623">import("workload_ca", cert PEM)</text><polygon fill="#A80036" points="63.5,732.0313,53.5,736.0313,63.5,740.0313,59.5,736.0313" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="57.5" x2="905" y1="736.0313" y2="736.0313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="17" x="69.5" y="730.8574">OK</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="23" x2="934" y1="745.0313" y2="745.0313"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="121" x="28" y="755.2363">[if Err(NOT_FOUND)]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="52.5" x2="94.5" y1="780.1563" y2="780.1563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="94.5" x2="94.5" y1="780.1563" y2="793.1563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="53.5" x2="94.5" y1="793.1563" y2="793.1563"/><polygon fill="#A80036" points="63.5,789.1563,53.5,793.1563,63.5,797.1563,59.5,793.1563" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="209" x="59.5" y="774.9824">generate new CSR for workload_ca</text><polygon fill="#A80036" points="692.5,818.3906,702.5,822.3906,692.5,826.3906,696.5,822.3906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52.5" x2="698.5" y1="822.3906" y2="822.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="378" x="59.5" y="817.2168">openssl::X509_sign(CSR, device_ca privkey openssl::EVP_PKEY)</text><polygon fill="#A80036" points="843.5,847.625,853.5,851.625,843.5,855.625,847.5,851.625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="714.5" x2="849.5" y1="851.625" y2="851.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="721.5" y="846.4512">sign("key handle", ...)</text><polygon fill="#A80036" points="725.5,876.8594,715.5,880.8594,725.5,884.8594,721.5,880.8594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="719.5" x2="859.5" y1="880.8594" y2="880.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="731.5" y="875.6855">OK(signature)</text><polygon fill="#A80036" points="63.5,906.0938,53.5,910.0938,63.5,914.0938,59.5,910.0938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="57.5" x2="708.5" y1="910.0938" y2="910.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="69.5" y="904.9199">OK(signed X509)</text><polygon fill="#A80036" points="889,935.3281,899,939.3281,889,943.3281,893,939.3281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52.5" x2="895" y1="939.3281" y2="939.3281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="59.5" y="934.1543">import("workload_ca", cert PEM)</text><polygon fill="#A80036" points="63.5,964.5625,53.5,968.5625,63.5,972.5625,59.5,968.5625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="57.5" x2="905" y1="968.5625" y2="968.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="17" x="69.5" y="963.3887">OK</text><path d="M23,997.5625 L114,997.5625 L114,1004.5625 L104,1014.5625 L23,1014.5625 L23,997.5625 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="163.3438" style="stroke: #000000; stroke-width: 2.0;" width="987" x="23" y="997.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="46" x="38" y="1010.623">MR init</text><polygon fill="#A80036" points="258.5,1032.0313,268.5,1036.0313,258.5,1040.0313,262.5,1036.0313" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52.5" x2="264.5" y1="1036.0313" y2="1036.0313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="59.5" y="1030.8574">get_provisioning_info()</text><polygon fill="#A80036" points="63.5,1061.2656,53.5,1065.2656,63.5,1069.2656,59.5,1065.2656" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="57.5" x2="274.5" y1="1065.2656" y2="1065.2656"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="123" x="69.5" y="1060.0918">OK(provisioning info)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="52.5" x2="94.5" y1="1094.5" y2="1094.5"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="94.5" x2="94.5" y1="1094.5" y2="1107.5"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="53.5" x2="94.5" y1="1107.5" y2="1107.5"/><polygon fill="#A80036" points="63.5,1103.5,53.5,1107.5,63.5,1111.5,59.5,1107.5" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="59.5" y="1089.3262">Start modules</text><polygon fill="#A80036" points="922,1117.5,932,1121.5,922,1125.5,926,1121.5" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52.5" x2="928" y1="1121.5" y2="1121.5"/><rect fill="#FEFECE" filter="url(#f1m3me46sidl98)" height="30.4063" style="stroke: #A80036; stroke-width: 1.5;" width="62" x="934" y="1115.5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="48" x="941" y="1135.4883">Module</text><path d="M13,1174.9063 L152,1174.9063 L152,1181.9063 L142,1191.9063 L13,1191.9063 L13,1174.9063 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="906.7969" style="stroke: #000000; stroke-width: 2.0;" width="1007" x="13" y="1174.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="94" x="28" y="1187.9668">Module things</text><path d="M23,1199.1406 L290,1199.1406 L290,1206.1406 L280,1216.1406 L23,1216.1406 L23,1199.1406 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="277.1094" style="stroke: #000000; stroke-width: 2.0;" width="987" x="23" y="1199.1406"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="222" x="38" y="1212.2012">Module wants to encrypt a secret</text><polygon fill="#A80036" points="68.5,1233.6094,58.5,1237.6094,68.5,1241.6094,64.5,1237.6094" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="62.5" x2="966" y1="1237.6094" y2="1237.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="74.5" y="1232.4355">encrypt(plaintext)</text><polygon fill="#A80036" points="258.5,1262.8438,268.5,1266.8438,258.5,1270.8438,262.5,1266.8438" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="57.5" x2="264.5" y1="1266.8438" y2="1266.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="64.5" y="1261.6699">encrypt(plaintext)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="280.5" x2="322.5" y1="1296.0781" y2="1296.0781"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="322.5" x2="322.5" y1="1296.0781" y2="1309.0781"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="281.5" x2="322.5" y1="1309.0781" y2="1309.0781"/><polygon fill="#A80036" points="291.5,1305.0781,281.5,1309.0781,291.5,1313.0781,287.5,1309.0781" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="287.5" y="1290.9043">Derive module ID plaintext</text><polygon fill="#A80036" points="843.5,1334.3125,853.5,1338.3125,843.5,1342.3125,847.5,1338.3125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="280.5" x2="849.5" y1="1338.3125" y2="1338.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="356" x="287.5" y="1333.1387">encrypt("master encryption key handle", module ID plaintext)</text><polygon fill="#A80036" points="291.5,1363.5469,281.5,1367.5469,291.5,1371.5469,287.5,1367.5469" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="285.5" x2="859.5" y1="1367.5469" y2="1367.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="297.5" y="1362.373">OK(module ID ciphertext)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="280.5" x2="322.5" y1="1396.7813" y2="1396.7813"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="322.5" x2="322.5" y1="1396.7813" y2="1409.7813"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="281.5" x2="322.5" y1="1409.7813" y2="1409.7813"/><polygon fill="#A80036" points="291.5,1405.7813,281.5,1409.7813,291.5,1413.7813,287.5,1409.7813" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="232" x="287.5" y="1391.6074">encrypt(plaintext, module ID ciphertext)</text><polygon fill="#A80036" points="68.5,1435.0156,58.5,1439.0156,68.5,1443.0156,64.5,1439.0156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="62.5" x2="274.5" y1="1439.0156" y2="1439.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="74.5" y="1433.8418">OK(ciphertext)</text><polygon fill="#A80036" points="955,1464.25,965,1468.25,955,1472.25,959,1468.25" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="52.5" x2="961" y1="1468.25" y2="1468.25"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="59.5" y="1463.0762">OK(ciphertext)</text><path d="M23,1490.25 L373,1490.25 L373,1497.25 L363,1507.25 L23,1507.25 L23,1490.25 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="277.1094" style="stroke: #000000; stroke-width: 2.0;" width="987" x="23" y="1490.25"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="305" x="38" y="1503.3105">Module wants to sign (HMAC-SHA256) a digest</text><polygon fill="#A80036" points="68.5,1524.7188,58.5,1528.7188,68.5,1532.7188,64.5,1528.7188" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="62.5" x2="966" y1="1528.7188" y2="1528.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="71" x="74.5" y="1523.5449">sign(digest)</text><polygon fill="#A80036" points="258.5,1553.9531,268.5,1557.9531,258.5,1561.9531,262.5,1557.9531" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="57.5" x2="264.5" y1="1557.9531" y2="1557.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="71" x="64.5" y="1552.7793">sign(digest)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="280.5" x2="322.5" y1="1587.1875" y2="1587.1875"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="322.5" x2="322.5" y1="1587.1875" y2="1600.1875"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="281.5" x2="322.5" y1="1600.1875" y2="1600.1875"/><polygon fill="#A80036" points="291.5,1596.1875,281.5,1600.1875,291.5,1604.1875,287.5,1600.1875" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="287.5" y="1582.0137">Derive module ID plaintext</text><polygon fill="#A80036" points="843.5,1625.4219,853.5,1629.4219,843.5,1633.4219,847.5,1629.4219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="280.5" x2="849.5" y1="1629.4219" y2="1629.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="356" x="287.5" y="1624.248">encrypt("master encryption key handle", module ID plaintext)</text><polygon fill="#A80036" points="291.5,1654.6563,281.5,1658.6563,291.5,1662.6563,287.5,1658.6563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="285.5" x2="859.5" y1="1658.6563" y2="1658.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="297.5" y="1653.4824">OK(module ID ciphertext)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="280.5" x2="322.5" y1="1687.8906" y2="1687.8906"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="322.5" x2="322.5" y1="1687.8906" y2="1700.8906"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="281.5" x2="322.5" y1="1700.8906" y2="1700.8906"/><polygon fill="#A80036" points="291.5,1696.8906,281.5,1700.8906,291.5,1704.8906,287.5,1700.8906" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="287.5" y="1682.7168">sign(plaintext, module ID ciphertext)</text><polygon fill="#A80036" points="68.5,1726.125,58.5,1730.125,68.5,1734.125,64.5,1730.125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="62.5" x2="274.5" y1="1730.125" y2="1730.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="74.5" y="1724.9512">OK(signature)</text><polygon fill="#A80036" points="955,1755.3594,965,1759.3594,955,1763.3594,959,1759.3594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="52.5" x2="961" y1="1759.3594" y2="1759.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="59.5" y="1754.1855">OK(signature)</text><path d="M23,1781.3594 L248,1781.3594 L248,1788.3594 L238,1798.3594 L23,1798.3594 L23,1781.3594 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="293.3438" style="stroke: #000000; stroke-width: 2.0;" width="987" x="23" y="1781.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="180" x="38" y="1794.4199">Module wants a server cert</text><polygon fill="#A80036" points="68.5,1815.8281,58.5,1819.8281,68.5,1823.8281,64.5,1819.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="62.5" x2="966" y1="1819.8281" y2="1819.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="74.5" y="1814.6543">Request server cert</text><polygon fill="#A80036" points="258.5,1845.0625,268.5,1849.0625,258.5,1853.0625,262.5,1849.0625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="57.5" x2="264.5" y1="1849.0625" y2="1849.0625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="64.5" y="1843.8887">Request server cert</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="280.5" x2="322.5" y1="1878.2969" y2="1878.2969"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="322.5" x2="322.5" y1="1878.2969" y2="1891.2969"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="281.5" x2="322.5" y1="1891.2969" y2="1891.2969"/><polygon fill="#A80036" points="291.5,1887.2969,281.5,1891.2969,291.5,1895.2969,287.5,1891.2969" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="410" x="287.5" y="1873.123">generate new privkey and CSR (in memory, not via openssl-engine-ks)</text><polygon fill="#A80036" points="692.5,1916.5313,702.5,1920.5313,692.5,1924.5313,696.5,1920.5313" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="280.5" x2="698.5" y1="1920.5313" y2="1920.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="392" x="287.5" y="1915.3574">openssl::X509_sign(CSR, workload_ca privkey openssl::EVP_PKEY)</text><polygon fill="#A80036" points="843.5,1945.7656,853.5,1949.7656,843.5,1953.7656,847.5,1949.7656" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="714.5" x2="849.5" y1="1949.7656" y2="1949.7656"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="721.5" y="1944.5918">sign("key handle", ...)</text><polygon fill="#A80036" points="725.5,1975,715.5,1979,725.5,1983,721.5,1979" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="719.5" x2="859.5" y1="1979" y2="1979"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="731.5" y="1973.8262">OK(signature)</text><polygon fill="#A80036" points="291.5,2004.2344,281.5,2008.2344,291.5,2012.2344,287.5,2008.2344" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="285.5" x2="708.5" y1="2008.2344" y2="2008.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="297.5" y="2003.0605">OK(signed X509)</text><polygon fill="#A80036" points="68.5,2033.4688,58.5,2037.4688,68.5,2041.4688,64.5,2037.4688" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="62.5" x2="274.5" y1="2037.4688" y2="2037.4688"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="137" x="74.5" y="2032.2949">OK(privkey, server cert)</text><polygon fill="#A80036" points="955,2062.7031,965,2066.7031,955,2070.7031,959,2066.7031" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="52.5" x2="961" y1="2066.7031" y2="2066.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="137" x="59.5" y="2061.5293">OK(privkey, server cert)</text><path d="M240.5,2095.7031 L434.5,2095.7031 L434.5,2102.7031 L424.5,2112.7031 L240.5,2112.7031 L240.5,2095.7031 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="308.3438" style="stroke: #000000; stroke-width: 2.0;" width="896.5" x="240.5" y="2095.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="149" x="255.5" y="2108.7637">Host_Module API calls</text><path d="M250.5,2119.9375 L636.5,2119.9375 L636.5,2126.9375 L626.5,2136.9375 L250.5,2136.9375 L250.5,2119.9375 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="277.1094" style="stroke: #000000; stroke-width: 2.0;" width="876.5" x="250.5" y="2119.9375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="341" x="265.5" y="2132.998">Host module wants to sign (HMAC-SHA256) a digest</text><polygon fill="#A80036" points="291.5,2154.4063,281.5,2158.4063,291.5,2162.4063,287.5,2158.4063" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="285.5" x2="1062.5" y1="2158.4063" y2="2158.4063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="77" x="297.5" y="2153.2324">get_identity()</text><polygon fill="#A80036" points="1051.5,2183.6406,1061.5,2187.6406,1051.5,2191.6406,1055.5,2187.6406" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="275.5" x2="1057.5" y1="2187.6406" y2="2187.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="282.5" y="2182.4668">OK(identity)</text><polygon fill="#A80036" points="291.5,2212.875,281.5,2216.875,291.5,2220.875,287.5,2216.875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="285.5" x2="1062.5" y1="2216.875" y2="2216.875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="71" x="297.5" y="2211.7012">sign(digest)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="280.5" x2="322.5" y1="2246.1094" y2="2246.1094"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="322.5" x2="322.5" y1="2246.1094" y2="2259.1094"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="281.5" x2="322.5" y1="2259.1094" y2="2259.1094"/><polygon fill="#A80036" points="291.5,2255.1094,281.5,2259.1094,291.5,2263.1094,287.5,2259.1094" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="287.5" y="2240.9355">Derive module ID plaintext</text><polygon fill="#A80036" points="843.5,2284.3438,853.5,2288.3438,843.5,2292.3438,847.5,2288.3438" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="280.5" x2="849.5" y1="2288.3438" y2="2288.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="356" x="287.5" y="2283.1699">encrypt("master encryption key handle", module ID plaintext)</text><polygon fill="#A80036" points="291.5,2313.5781,281.5,2317.5781,291.5,2321.5781,287.5,2317.5781" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="285.5" x2="859.5" y1="2317.5781" y2="2317.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="297.5" y="2312.4043">OK(module ID ciphertext)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="280.5" x2="322.5" y1="2346.8125" y2="2346.8125"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="322.5" x2="322.5" y1="2346.8125" y2="2359.8125"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="281.5" x2="322.5" y1="2359.8125" y2="2359.8125"/><polygon fill="#A80036" points="291.5,2355.8125,281.5,2359.8125,291.5,2363.8125,287.5,2359.8125" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="287.5" y="2341.6387">sign(plaintext, module ID ciphertext)</text><polygon fill="#A80036" points="1051.5,2385.0469,1061.5,2389.0469,1051.5,2393.0469,1055.5,2389.0469" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="275.5" x2="1057.5" y1="2389.0469" y2="2389.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="282.5" y="2383.873">OK(signature)</text><!--MD5=[60c0d7fa1402022c78515c409e82f2cf]
@startuml


participant MR
participant IS
participant "openssl-engine-ks"
participant KS
participant CS
participant Module
participant Host_Module


group Master encryption key
	MR -> KS ++: create_key_if_not_exists("master")
	return OK("key handle")
end

group Device CA
	MR -> KS ++: load_key_pair("device_ca")
	return OK("key handle")
	MR -> "openssl-engine-ks" ++: load_private_key("key handle")
	return openssl::EVP_PKEY
	MR -> CS ++: create_or_load_cert("device_ca")
	return OK(cert PEM)
end

group Workload CA
	MR -> KS ++: create_key_pair_if_not_exists("workload_ca")
	return OK("key handle")
	MR -> "openssl-engine-ks" ++: load_private_key("key handle")
	return openssl::EVP_PKEY
	MR -> CS ++: create_or_load_cert("workload_ca")
	return OK(cert PEM) or Err(NOT_FOUND)

	alt if OK(cert PEM)
		MR -> "openssl-engine-ks" ++: openssl::X509_verify(CSR, device_ca privkey openssl::EVP_PKEY)
		"openssl-engine-ks" -> KS ++: sign("key handle", ...)
		return OK(signature)
		return OK(signed X509)
		MR -> CS ++: import("workload_ca", cert PEM)
		return OK

	else if Err(NOT_FOUND)
		MR -> MR: generate new CSR for workload_ca
		MR -> "openssl-engine-ks" ++: openssl::X509_sign(CSR, device_ca privkey openssl::EVP_PKEY)
		"openssl-engine-ks" -> KS ++: sign("key handle", ...)
		return OK(signature)
		return OK(signed X509)
		MR -> CS ++: import("workload_ca", cert PEM)
		return OK
	end
end

group MR init
	MR -> IS ++: get_provisioning_info()
	return OK(provisioning info)

	MR -> MR: Start modules
	MR -> Module **
end

group Module things
	group Module wants to encrypt a secret
		Module -> MR ++: encrypt(plaintext)
		MR -> IS ++: encrypt(plaintext)
		IS -> IS: Derive module ID plaintext
		IS -> KS ++: encrypt("master encryption key handle", module ID plaintext)
		return OK(module ID ciphertext)
		IS -> IS: encrypt(plaintext, module ID ciphertext)
		return OK(ciphertext)
		return OK(ciphertext)
	end

	group Module wants to sign (HMAC-SHA256) a digest
		Module -> MR ++: sign(digest)
		MR -> IS ++: sign(digest)
		IS -> IS: Derive module ID plaintext
		IS -> KS ++: encrypt("master encryption key handle", module ID plaintext)
		return OK(module ID ciphertext)
		IS -> IS: sign(plaintext, module ID ciphertext)
		return OK(signature)
		return OK(signature)
	end

	group Module wants a server cert
		Module -> MR ++: Request server cert
		MR -> IS ++: Request server cert
		IS -> IS: generate new privkey and CSR (in memory, not via openssl-engine-ks)
		IS -> "openssl-engine-ks" ++: openssl::X509_sign(CSR, workload_ca privkey openssl::EVP_PKEY)
		"openssl-engine-ks" -> KS ++: sign("key handle", ...)
		return OK(signature)
		return OK(signed X509)	
		return OK(privkey, server cert)
		return OK(privkey, server cert)
	end
end

group Host_Module API calls
	group Host module wants to sign (HMAC-SHA256) a digest
		Host_Module -> IS ++: get_identity()
		return OK(identity)
		Host_Module -> IS ++: sign(digest)
		IS -> IS: Derive module ID plaintext
		IS -> KS ++: encrypt("master encryption key handle", module ID plaintext)
		return OK(module ID ciphertext)
		IS -> IS: sign(plaintext, module ID ciphertext)
		return OK(signature)
	end
end


@enduml

PlantUML version 1.2020.06(Sun Apr 05 05:38:32 PDT 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.6+10-suse-3.1-x8664
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>